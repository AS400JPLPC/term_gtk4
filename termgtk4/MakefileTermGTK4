#définition des cibles particulières
.PHONY: all clean build

# nom de l'executable :
PROJET = $(PGM)


# Adresse des sources, des objets et des includes :
SRCDIR = $(CURDIR)/src_c/
OBJDIR = $(CURDIR)/obj/
BINDIR = $(CURDIR)/


INCLUDES =\
-I`pkg-config --cflags gtk4` \
-I`pkg-config --cflags vte-2.91-gtk4` \
-I`pkg-config --cflags glib-2.0` \
-I$(SRCDIR)

INCLIB =\
-I`pkg-config --libs gtk4` \
-I`pkg-config --libs vte-2.91-gtk4 ` \
-I`pkg-config --libs glib-2.0`



#/usr/lib/x86_64-linux-gnu/libdl.so

OBJ = $(OBJDIR)$(PROJET).o
RESULT = $(BINDIR)$(PROJET)


# choix du compilateur :
#CXX = g++
CXX =clang++

# options compilations : voir vte-dev  -Wextra -Wno-unused-parameter   use juste for debug only for you  -Os -s
# -------------------------------------------------------------------
#  production
# -------------------------------------------------------------------
ifeq ($(PROD), true)
 CPPFLAGS=	-std=c++20 \
 	        -Wall	-fexceptions	-pedantic-errors	-Wno-parentheses	-Waddress	\
 			-Wsign-compare -fpermissive 	-fstack-clash-protection \
            `pkg-config --cflags gtk4` \
 			`pkg-config --cflags vte-2.91-gtk4` \
			`pkg-config --cflags glib-2.0`

#  -no-pie because it's the master program of the project so the caller  `pkg-config gmodule-2.0 --libs`
LDFLAGS =	-lX11 -no-pie `pkg-config --libs gtk4  vte-2.91-gtk4   glib-2.0`

OPTIMIZE = -fexpensive-optimizations -Os -s

# -------------------------------------------------------------------
#  debug	-fno-omit-frame-pointer
# -------------------------------------------------------------------

else
CPPFLAGS=	-std=c++20 -ggdb -g3  \
			-Wall	-fexceptions	-pedantic-errors	-Wno-parentheses	-Waddress \
			-Wsign-compare -fpermissive \
            `pkg-config --cflags gtk4` \
			`pkg-config --cflags vte-2.91-gtk4` \
			`pkg-config --cflags glib-2.0`

LDFLAGS =	-lX11   -no-pie  `pkg-config --libs gtk4  vte-2.91-gtk4   glib-2.0`

OPTIMIZE =
endif
# -------------------------------------------------------------------
#  compilation
# -------------------------------------------------------------------
# compilation obj :  ex  #@echo "$(OBJCPP)"
#
# debug -v   prod [ on enleve les symboles -s & compression ...]


# regle edition de liens
all: $(OBJ)
	$(CXX)  $(OBJ) -o $(RESULT) $(OPTIMIZE) $(LDFLAGS) $(INCLIB)

ifeq ($(PROD), true)
	rm	-rf	$(OBJDIR)$(PROJET).o
endif

# regle de compilation des sources objet
$(OBJDIR)%.o: $(SRCDIR)%.cpp
	$(CXX) $(CPPFLAGS) $(INCLUDES)  -o $@ -c $<



# pour effacer tous les objets :
clean:
	rm -rf  $(OBJDIR)*.o
	rm -rf  $(RESULT)
